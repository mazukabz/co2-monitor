# Infisical â€” Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ CO2 Monitor

## 1. Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Infisical

**Infisical** â€” open-source Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ². ĞœÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ **Infisical Cloud EU** (eu.infisical.com) Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°.

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ¡ĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² `.env` Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
- Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ (Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ)
- ĞÑƒĞ´Ğ¸Ñ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- Machine Identity Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²

---

## 2. Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° CO2 Monitor

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **URL ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸** | https://eu.infisical.com |
| **Project ID** | `04ac3c18-2975-4e2a-9a08-f5b831f13d9e` |
| **Environment** | `prod` |
| **Machine Identity Client ID** | `97bc8628-39ac-47ed-adc4-9db614fe717a` |
| **Machine Identity Client Secret** | `a15ca6c4e4d9b9e6b248cff1a5bc1680053c2bd281194c49ef77cb292387bd07` |

### Ğ¡ĞµÑ€Ğ²ĞµÑ€
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **IP** | 31.59.170.64 |
| **ĞŸÑƒÑ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°** | /opt/apps/co2 |

---

## 3. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² Infisical

Ğ¡ĞµĞºÑ€ĞµÑ‚Ñ‹ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹ Ğ½Ğ° Ğ´Ğ²Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸:

### /co2_secrets (Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECRET NAME       â”‚ ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ•                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POSTGRES_PASSWORD â”‚ ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ PostgreSQL                               â”‚
â”‚ BOT_TOKEN         â”‚ Ğ¢Ğ¾ĞºĞµĞ½ Telegram Ğ±Ğ¾Ñ‚Ğ° Ğ¾Ñ‚ @BotFather               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### /co2_configs (ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECRET NAME      â”‚ ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ•                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POSTGRES_USER    â”‚ co2_user                                        â”‚
â”‚ POSTGRES_DB      â”‚ co2_db                                          â”‚
â”‚ DATABASE_URL     â”‚ postgresql+asyncpg://...@co2_db:5432/co2_db     â”‚
â”‚ DB_EXTERNAL_PORT â”‚ 10532 (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº PostgreSQL)             â”‚
â”‚ MQTT_PORT        â”‚ 10883 (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ»Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²)            â”‚
â”‚ API_PORT         â”‚ 10900 (Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğ¹ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ)                   â”‚
â”‚ ADMIN_USER_IDS   â”‚ 5562787884                                      â”‚
â”‚ TZ               â”‚ Europe/Moscow                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹!
- **Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹** (10532, 10883, 10900) â€” Ğ±ĞµÑ€ÑƒÑ‚ÑÑ Ğ¸Ğ· Infisical
- **Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹** (5432, 1883, 8000) â€” Ğ·Ğ°Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ¶ĞµĞ½Ñ‹ Ğ² Docker, Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ‚ÑŒ
- **ĞĞ• ĞœĞ•ĞĞ¯Ğ¢Ğ¬ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹** Ğ±ĞµĞ· ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ñ!

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ¤Ğ»Ğ°Ğ³ `--recursive` Ğ² `infisical run` Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´Ğ¿Ğ°Ğ¿Ğ¾Ğº.

---

## 4. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Infisical CLI Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€

```bash
# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
curl -1sLf 'https://dl.cloudsmith.io/public/infisical/infisical-cli/setup.deb.sh' | sudo bash

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ CLI
sudo apt-get update && sudo apt-get install -y infisical

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ
infisical --version
```

---

## 5. start.sh Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ°Ğ¼Ğ¸

Ğ¤Ğ°Ğ¹Ğ» `/opt/apps/co2/start.sh`:

```bash
#!/bin/bash
# CO2 Monitor Startup Script with Infisical Secrets

set -e
cd /opt/apps/co2

echo "ğŸ” Authenticating with Infisical..."
export INFISICAL_TOKEN=$(infisical login --method=universal-auth \
  --client-id=97bc8628-39ac-47ed-adc4-9db614fe717a \
  --client-secret=a15ca6c4e4d9b9e6b248cff1a5bc1680053c2bd281194c49ef77cb292387bd07 \
  --domain=https://eu.infisical.com \
  --silent --plain)

if [ -z "$INFISICAL_TOKEN" ]; then
  echo "âŒ Failed to authenticate with Infisical"
  exit 1
fi

echo "âœ… Authenticated successfully"
echo "ğŸš€ Starting services with secrets from Infisical..."

infisical run \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --recursive \
  --domain=https://eu.infisical.com \
  -- docker compose up -d --build

echo "âœ… Services started!"
docker compose ps
```

**ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:**
1. `infisical login` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ñ‡ĞµÑ€ĞµĞ· Machine Identity
2. `infisical run` â€” Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ ĞºĞ°Ğº Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
3. `docker compose up` â€” Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ñ ÑÑ‚Ğ¸Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸

---

## 6. CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
```bash
export INFISICAL_TOKEN=$(infisical login --method=universal-auth \
  --client-id=97bc8628-39ac-47ed-adc4-9db614fe717a \
  --client-secret=a15ca6c4e4d9b9e6b248cff1a5bc1680053c2bd281194c49ef77cb292387bd07 \
  --domain=https://eu.infisical.com \
  --silent --plain)
```

### ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²
```bash
# Ğ˜Ğ· Ğ¿Ğ°Ğ¿ĞºĞ¸ /co2_secrets
infisical secrets \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --path=/co2_secrets \
  --domain=https://eu.infisical.com

# Ğ˜Ğ· Ğ¿Ğ°Ğ¿ĞºĞ¸ /co2_configs
infisical secrets \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --path=/co2_configs \
  --domain=https://eu.infisical.com
```

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚
```bash
# Ğ’ Ğ¿Ğ°Ğ¿ĞºÑƒ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²
infisical secrets set BOT_TOKEN="your_token" \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --path=/co2_secrets \
  --domain=https://eu.infisical.com

# Ğ’ Ğ¿Ğ°Ğ¿ĞºÑƒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¾Ğ²
infisical secrets set MQTT_PORT="10883" \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --path=/co2_configs \
  --domain=https://eu.infisical.com
```

### Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ°Ğ¼Ğ¸
```bash
# --recursive Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´Ğ¿Ğ°Ğ¿Ğ¾Ğº
infisical run \
  --projectId=04ac3c18-2975-4e2a-9a08-f5b831f13d9e \
  --env=prod \
  --recursive \
  --domain=https://eu.infisical.com \
  -- docker compose up -d
```

---

## 7. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ÑĞµĞºÑ€ĞµÑ‚Ğ°

### Ğ¨Ğ°Ğ³ 1: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Infisical
```bash
infisical secrets set NEW_VAR="value" --projectId=... --env=prod --domain=https://eu.infisical.com
```

### Ğ¨Ğ°Ğ³ 2: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² docker-compose.yml
```yaml
co2_bot:
  environment:
    - NEW_VAR=${NEW_VAR:-default_value}
```

### Ğ¨Ğ°Ğ³ 3: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² app/core/config.py
```python
class Settings(BaseSettings):
    new_var: str = "default_value"
```

### Ğ¨Ğ°Ğ³ 4: ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
```bash
./start.sh
```

---

## 8. Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

1. **Client Secret** Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ² `start.sh`
2. `.env` Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞĞ• ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ÑÑ‚ÑÑ (Ğ² .gitignore)
3. Infisical ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ at rest
4. ĞÑƒĞ´Ğ¸Ñ‚ Ğ²ÑĞµÑ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞµ
